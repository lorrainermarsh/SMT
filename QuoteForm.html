<!-- QuoteForm.html — Operations sidebar form (no VSK-only path) -->
<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;font-size:13px;padding:12px}
      label{display:block;margin:10px 0 4px}
      select,input,textarea{width:100%;box-sizing:border-box;padding:6px}
      .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
      .hint{color:#666;font-size:12px}
      .section{margin-top:14px;padding-top:10px;border-top:1px solid #eee}
    </style>
    <script>
      /* Client -> Server helpers */
      function onLoad() {
        google.script.run.withSuccessHandler(initForm).form_getInitialData();
      }
      function initForm(data){
        // populate dropdowns
        bindOptions('make', data.makes);
        bindOptions('model', data.models);
        bindOptions('body', data.bodies);
        bindOptions('vehDescTow', data.vehicleDescriptions);
        bindOptions('vehDescVsk', data.vehicleDescriptions); // same list; VSK Year replaced with Vehicle Description
        bindOptions('towbarType', data.towbarTypes);
        bindOptions('vskTowbarType', data.vskTowbarTypes);

        document.getElementById('vskRequired').addEventListener('change', updateTowbarNotes);
        document.getElementById('vskTowbarType').addEventListener('change', updateVskNotes);
        ['make','model','body','vehDescVsk'].forEach(id => document.getElementById(id).addEventListener('change', updateExtensionKit));
      }

      function bindOptions(id, list){
        const el = document.getElementById(id);
        el.innerHTML = '<option value="">— Select —</option>' + (list||[]).map(v=>`<option>${v}</option>`).join('');
      }

      function updateTowbarNotes(){
        const payload = readForm();
        google.script.run.withSuccessHandler(v => document.getElementById('towbarNotes').value = v || '')
          .form_lookupTowbarNotes(payload);
      }
      function updateVskNotes(){
        const payload = readForm();
        google.script.run.withSuccessHandler(v => document.getElementById('vskNotes').value = v || '')
          .form_lookupVskNotes(payload);
      }
      function updateExtensionKit(){
        const payload = readForm();
        google.script.run.withSuccessHandler(v => document.getElementById('extensionKit').value = v || '')
          .form_lookupVskExtensionRequired(payload);
      }

      function readForm(){
        const g = id => document.getElementById(g.arguments[0]).value || '';
        return {
          make: g('make'),
          model: g('model'),
          body: g('body'),
          vehDescTow: g('vehDescTow'),   // Towbar Vehicle Description
          towbarType: g('towbarType'),
          vskRequired: g('vskRequired'),
          vskTowbarType: g('vskTowbarType'),
          vehDescVsk: g('vehDescVsk')    // VSK Vehicle Description (Year removed)
        };
      }
      function submitQuote(){
        const data = readForm();
        google.script.run.withSuccessHandler(msg => alert(msg)).processQuoteFromForm(data);
      }
    </script>
  </head>
  <body onload="onLoad()">
    <h3>Somerset Mobile Towbars — Quote</h3>

    <div class="row">
      <div>
        <label>Make</label>
        <select id="make"></select>
      </div>
      <div>
        <label>Model</label>
        <select id="model"></select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Body Type</label>
        <select id="body"></select>
      </div>
      <div>
        <label>Vehicle Description (Towbar)</label>
        <select id="vehDescTow"></select>
        <div class="hint">Replaces “Towbar Year”.</div>
      </div>
    </div>

    <div class="row section">
      <div>
        <label>Towbar Type</label>
        <select id="towbarType"></select>
      </div>
      <div>
        <label>VSK required</label>
        <select id="vskRequired">
          <option value="">— Select —</option>
          <option>Yes</option>
          <option>No</option>
        </select>
      </div>
    </div>

    <div class="section">
      <label>Towbar Notes (from TT Towbar Notes)</label>
      <textarea id="towbarNotes" readonly rows="3" placeholder="Auto-filled when VSK required changes"></textarea>
    </div>

    <div class="row section">
      <div>
        <label>VSK Towbar Type</label>
        <select id="vskTowbarType"></select>
      </div>
      <div>
        <label>Vehicle Description (VSK)</label>
        <select id="vehDescVsk"></select>
        <div class="hint">Replaces “VSK Year”.</div>
      </div>
    </div>

    <div class="section">
      <label>VSK Notes (from TT VSK Notes)</label>
      <textarea id="vskNotes" readonly rows="3" placeholder="Auto-filled from VSK Towbar Type"></textarea>
    </div>

    <div class="section">
      <label>Extension kit required (from TT VSK)</label>
      <input id="extensionKit" type="text" readonly placeholder="Auto-filled from Make/Model/Body/Vehicle Description">
    </div>

    <div class="section">
      <button onclick="submitQuote()">Generate Quote</button>
    </div>
  </body>
</html>
